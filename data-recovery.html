<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®æ¢å¤åŠ©æ‰‹ - å¥èº«æ•™ç»ƒä¼šå‘˜ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body class="bg-gray-50 min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">ğŸ” æ•°æ®æ¢å¤åŠ©æ‰‹</h1>
            
            <!-- æ•°æ®æ£€æŸ¥ç»“æœ -->
            <div id="checkResult" class="mb-6"></div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <button onclick="checkData()" class="btn btn-primary">
                    <span>ğŸ”</span>
                    <span>æ£€æŸ¥æ•°æ®çŠ¶æ€</span>
                </button>
                <button onclick="viewRawData()" class="btn btn-secondary">
                    <span>ğŸ“„</span>
                    <span>æŸ¥çœ‹åŸå§‹æ•°æ®</span>
                </button>
                <button onclick="exportBackup()" class="btn btn-secondary">
                    <span>ğŸ’¾</span>
                    <span>å¯¼å‡ºå¤‡ä»½</span>
                </button>
                <button onclick="importBackup()" class="btn btn-secondary">
                    <span>ğŸ“¥</span>
                    <span>å¯¼å…¥å¤‡ä»½</span>
                </button>
            </div>

            <!-- å¸®åŠ©ä¿¡æ¯ -->
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                <h3 class="font-semibold text-blue-800 mb-2">ğŸ’¡ æ•°æ®ä¸¢å¤±å¯èƒ½çš„åŸå› ï¼š</h3>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>â€¢ æ¸…é™¤äº†æµè§ˆå™¨ç¼“å­˜æˆ–Cookie</li>
                    <li>â€¢ ä½¿ç”¨äº†éšç§/æ— ç—•æµè§ˆæ¨¡å¼</li>
                    <li>â€¢ æ›´æ¢äº†æµè§ˆå™¨æˆ–è®¾å¤‡</li>
                    <li>â€¢ åœ¨æ•°æ®ç®¡ç†ä¸­è¯¯ç‚¹äº†"æ¸…ç©ºæ‰€æœ‰æ•°æ®"</li>
                    <li>â€¢ æµè§ˆå™¨å­˜å‚¨ç©ºé—´å·²æ»¡</li>
                </ul>
            </div>

            <!-- è§£å†³æ–¹æ¡ˆ -->
            <div class="bg-green-50 border-l-4 border-green-400 p-4">
                <h3 class="font-semibold text-green-800 mb-2">âœ… è§£å†³æ–¹æ¡ˆï¼š</h3>
                <ul class="text-sm text-green-700 space-y-1">
                    <li>1. æ£€æŸ¥æ˜¯å¦æœ‰ä¹‹å‰å¯¼å‡ºçš„å¤‡ä»½æ–‡ä»¶ï¼ˆ.jsonæ ¼å¼ï¼‰</li>
                    <li>2. å¦‚æœæœ‰å¤‡ä»½ï¼Œç‚¹å‡»"å¯¼å…¥å¤‡ä»½"æ¢å¤æ•°æ®</li>
                    <li>3. å¦‚æœæ²¡æœ‰å¤‡ä»½ï¼Œå¯ä»¥é‡æ–°å½•å…¥ä¼šå‘˜ä¿¡æ¯</li>
                    <li>4. å»ºè®®å®šæœŸä½¿ç”¨"å¯¼å‡ºå¤‡ä»½"åŠŸèƒ½ä¿å­˜æ•°æ®</li>
                </ul>
            </div>

            <!-- è¿”å›æŒ‰é’® -->
            <div class="mt-6 text-center">
                <a href="index.html" class="inline-block px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                    â† è¿”å›é¦–é¡µ
                </a>
            </div>
        </div>
    </div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" id="importFileInput" accept=".json" style="display: none">

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modalContainer"></div>

    <script src="./js/data.js"></script>
    <script>
        // æ£€æŸ¥æ•°æ®çŠ¶æ€
        function checkData() {
            const members = DataManager.getMembers();
            const trainings = DataManager.getAllTrainingRecords();
            
            let html = '<div class="bg-white border-2 rounded-lg p-6">';
            html += '<h3 class="text-lg font-semibold mb-4">ğŸ“Š æ•°æ®çŠ¶æ€æŠ¥å‘Š</h3>';
            
            if (members.length > 0) {
                html += `
                    <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <p class="text-green-800 font-semibold">âœ… æ‰¾åˆ° ${members.length} ä¸ªä¼šå‘˜è®°å½•</p>
                        <ul class="mt-2 text-sm text-green-700">
                            ${members.map(m => `<li>â€¢ ${m.name} - ${m.phone} (å‰©ä½™è¯¾æ—¶: ${m.remainingCourses})</li>`).join('')}
                        </ul>
                    </div>
                `;
            } else {
                html += `
                    <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-red-800 font-semibold">âŒ æœªæ‰¾åˆ°ä¼šå‘˜è®°å½•</p>
                        <p class="text-sm text-red-600 mt-2">æ•°æ®å¯èƒ½å·²ä¸¢å¤±ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰å¤‡ä»½æ–‡ä»¶</p>
                    </div>
                `;
            }
            
            if (trainings.length > 0) {
                html += `
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-blue-800 font-semibold">âœ… æ‰¾åˆ° ${trainings.length} æ¡è®­ç»ƒè®°å½•</p>
                    </div>
                `;
            } else {
                html += `
                    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p class="text-yellow-800 font-semibold">âš ï¸ æœªæ‰¾åˆ°è®­ç»ƒè®°å½•</p>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºå­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
            const membersData = localStorage.getItem('fitnessMembers') || '';
            const trainingsData = localStorage.getItem('trainingRecords') || '';
            const totalSize = new Blob([membersData + trainingsData]).size;
            const sizeKB = (totalSize / 1024).toFixed(2);
            
            html += `
                <div class="mt-4 p-3 bg-gray-50 rounded">
                    <p class="text-sm text-gray-600">å­˜å‚¨ç©ºé—´ä½¿ç”¨: ${sizeKB} KB</p>
                </div>
            `;
            
            html += '</div>';
            
            document.getElementById('checkResult').innerHTML = html;
        }

        // æŸ¥çœ‹åŸå§‹æ•°æ®
        function viewRawData() {
            const members = localStorage.getItem('fitnessMembers');
            const trainings = localStorage.getItem('trainingRecords');
            
            const html = `
                <div class="modal-overlay">
                    <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                        <div class="modal-header">
                            <h2 class="modal-title">ğŸ“„ åŸå§‹æ•°æ®</h2>
                        </div>
                        <div class="modal-body" style="overflow-y: auto;">
                            <h3 class="font-semibold mb-2">ä¼šå‘˜æ•°æ® (fitnessMembers):</h3>
                            <pre class="bg-gray-100 p-3 rounded text-xs overflow-x-auto mb-4">${members || '(æ— æ•°æ®)'}</pre>
                            
                            <h3 class="font-semibold mb-2">è®­ç»ƒè®°å½• (trainingRecords):</h3>
                            <pre class="bg-gray-100 p-3 rounded text-xs overflow-x-auto">${trainings || '(æ— æ•°æ®)'}</pre>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeModal()">å…³é—­</button>
                        </div>
                    </div>
                </div>
            `;
            showModal(html);
        }

        // å¯¼å‡ºå¤‡ä»½
        function exportBackup() {
            const members = DataManager.getMembers();
            const trainings = DataManager.getAllTrainingRecords();
            
            const backup = {
                exportDate: new Date().toISOString(),
                version: '1.0',
                members: members,
                trainings: trainings
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            alert('âœ… å¤‡ä»½å¯¼å‡ºæˆåŠŸï¼è¯·å¦¥å–„ä¿ç®¡å¤‡ä»½æ–‡ä»¶ã€‚');
        }

        // å¯¼å…¥å¤‡ä»½
        function importBackup() {
            document.getElementById('importFileInput').click();
        }

        // åˆå§‹åŒ–æ–‡ä»¶è¾“å…¥
        document.getElementById('importFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const backup = JSON.parse(event.target.result);
                    
                    if (!backup.members || !backup.trainings) {
                        alert('âŒ å¤‡ä»½æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                        return;
                    }
                    
                    if (confirm(`ç¡®å®šè¦å¯¼å…¥å¤‡ä»½å—ï¼Ÿ

å°†å¯¼å…¥ï¼š
â€¢ ${backup.members.length} ä¸ªä¼šå‘˜
â€¢ ${backup.trainings.length} æ¡è®­ç»ƒè®°å½•

âš ï¸ è¿™å°†è¦†ç›–å½“å‰æ•°æ®ï¼`)) {
                        localStorage.setItem('fitnessMembers', JSON.stringify(backup.members));
                        localStorage.setItem('trainingRecords', JSON.stringify(backup.trainings));
                        
                        alert('âœ… æ•°æ®æ¢å¤æˆåŠŸï¼');
                        checkData();
                    }
                } catch (error) {
                    alert('âŒ æ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
            
            e.target.value = '';
        });

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(html) {
            document.getElementById('modalContainer').innerHTML = html;
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('modalContainer').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('DOMContentLoaded', checkData);
    </script>
</body>
</html>
